SEASONAL STOCK PATTERN DETECTOR - METHODOLOGY
==============================================

OVERVIEW
--------
This tool analyzes historical stock price data to identify recurring seasonal
patterns. By examining how a stock performs during specific periods (weeks or
months) across multiple years, we can identify statistically significant trends
that may inform trading decisions.


DATA SOURCE
-----------
- Historical OHLC (Open, High, Low, Close) data from Yahoo Finance
- Default analysis window: 15 years of data
- Years 2020 and 2021 are excluded due to COVID-19 market anomalies
- Data is cached locally in CSV format for faster subsequent loads


PERIOD TYPES
------------
1. MONTHLY (13 periods)
   - 12 calendar months (Jan through Dec)
   - Plus "Jan+" wraparound period (January of the following year)
   - Allows detection of patterns spanning year boundaries

2. WEEKLY (53 periods)
   - 52 calendar weeks aligned to the first Monday of each year
   - Plus "Week 1+" wraparound period
   - More granular analysis but noisier signals


OFFSET PARAMETER
----------------
The offset shifts all period boundaries by N days forward.

Example (Monthly, Offset = 15):
- Standard January: Jan 1 - Jan 31
- With offset 15:   Jan 16 - Feb 15

This allows discovery of patterns that don't align with calendar boundaries.
Some market patterns may be driven by events like options expiration (3rd Friday)
or month-end rebalancing, which don't fall on the 1st of the month.

Range: 0-30 days (monthly), 0-6 days (weekly)


CALCULATING RETURNS
-------------------
For each period in each year:

1. Find the first trading day on or after the period start date
2. Find the last trading day on or before the period end date
3. Calculate return: ((Close_last / Open_first) - 1) × 100%

This gives us a matrix of returns:
- Rows: Periods (Jan, Feb, ... or Week 1, Week 2, ...)
- Columns: Years (2010, 2011, ..., 2024, excluding 2020-2021)


TREND LIKELIHOOD %
------------------
For each period, we calculate what percentage of years showed the dominant direction.

Formula:
  green_count = years with return >= 0
  red_count = years with return < 0
  trend_pct = max(green_count, red_count) / total_years × 100

Example:
  If January was positive in 10 out of 13 years:
  Trend Likelihood = 77% (Bullish)

Interpretation:
- 50% = No trend (random)
- 60% = Weak trend
- 70% = Moderate trend
- 80%+ = Strong trend


THRESHOLD PARAMETER
-------------------
The threshold filters out weak signals. Periods with Trend Likelihood below
the threshold are considered "neutral" and displayed in blue.

Effects:
- Neutral periods do not form or extend runs
- Neutral periods break existing runs
- Trades are not generated for neutral periods

Range: 50-100%
Default: 50% (no filtering)

Rationale: A 55% trend likelihood means the pattern held in just over half the
years - barely better than a coin flip. Higher thresholds focus on stronger,
more reliable patterns.


EXPECTED VALUE (EV)
-------------------
EV combines the average magnitude of moves with their likelihood.

Formula:
  EV = |average_return| × (trend_pct / 100) × direction

Where:
  - average_return = mean of all yearly returns for this period
  - trend_pct = trend likelihood percentage
  - direction = +1 if bullish, -1 if bearish

Example:
  January averages +2.5% with 77% bullish trend
  EV = 2.5 × 0.77 × 1 = +1.93

Interpretation:
  EV represents the expected gain/loss if you traded this period every year.
  Higher absolute EV = stronger, more consistent pattern.


RUN DETECTION
-------------
A "run" is a sequence of 2+ consecutive periods with the same direction
(all bullish or all bearish) where all periods meet the threshold requirement.

Run detection algorithm:
1. Iterate through periods in order
2. Track current run: start index, direction, cumulative EV
3. When direction changes or a neutral period is encountered:
   - If current run length >= 2, save it
   - Start new run
4. Calculate RunEV = sum of individual EVs in the run

Runs are highlighted in the UI:
- Green background: Bullish runs (consecutive positive EV periods)
- Red background: Bearish runs (consecutive negative EV periods)

RunEV is displayed at the end of each run, showing the cumulative expected
value of holding through the entire run.


TRADE SIMULATION
----------------
We simulate a trading strategy that:
- Enters at the START of each bullish run
- Exits at the END of each bullish run
- Stays in cash during bearish runs and neutral periods

For each trade in each historical year:

1. ENTRY DATE
   Calculated as: First day of entry period + offset
   Example: "Jan" with offset 15 → "Jan-16"

2. EXIT DATE
   Calculated as: Last day of exit period + offset
   Example: "Mar" with offset 15 → "Apr-15"

3. PROFIT CALCULATION (per year)
   Compound the returns of all periods in the run:
   
   profit = (∏(1 + period_return/100) - 1) × 100
   
   Example: Jan +2%, Feb +1%, Mar +3%
   profit = ((1.02 × 1.01 × 1.03) - 1) × 100 = 6.12%

4. DAYS HELD
   Sum of calendar days for all periods in the run.
   Monthly periods use actual month lengths (31, 28, 31, ...)
   Weekly periods use 7 days each.

5. ANNUALIZED RETURN
   Scales the profit to a yearly equivalent:
   
   annualized = profit × (365 / days_held)
   
   Example: 6.12% over 90 days
   annualized = 6.12 × (365/90) = 24.8%


TOTAL ROW
---------
Aggregates all trades for each year:

- Average Profit: Mean of total yearly profits across all years
- Days Held: Average total days in market per year
- Annualized: Average profit × (365 / average days)
- Per-year columns: Compounded profit from all trades that year


BUY & HOLD (B&H) ROW
--------------------
Benchmark comparison - what if you held all year?

For each year:
  B&H profit = compound of ALL period returns (Jan through Jan+)

This represents passive investing with no timing.


EDGE ROW
--------
Shows the advantage (or disadvantage) of the seasonal strategy vs B&H.

Formula:
  Edge = TOTAL Annualized Return - B&H Annualized Return

Interpretation:
- Positive Edge: Seasonal strategy outperforms on risk-adjusted basis
- Negative Edge: B&H would have been better

Note: Even a negative Edge might be acceptable if:
- You want reduced time in market (lower risk exposure)
- The strategy has lower drawdowns
- You need capital for other opportunities


BASKET ANALYSIS
---------------
When multiple symbols are entered (comma-separated), returns are synthesized:

1. Align all symbols to common trading dates
2. For each day, calculate the ratio vs previous close for each symbol
3. Average the ratios across symbols (equal weighting)
4. Reconstruct a synthetic price series from the averaged ratios

This creates a "basket" that represents the average behavior of all symbols,
useful for analyzing sector-wide or market-wide seasonal patterns.


FILE EXPORT
-----------
Two CSV files are generated:

1. SYMBOL-PERIOD+OFFSET@THRESHOLD.stats.csv
   Contains the seasonal analysis table:
   - Period, Trend Likelihood %, Trend Direction
   - Expected Value %, Average Return %
   - Per-year returns with sign preserved

2. SYMBOL-PERIOD+OFFSET@THRESHOLD.trades.csv
   Contains the trade simulation:
   - Entry Date, Exit Date, Average Profit %, Days Held, Annualized Return %
   - Per-year profits
   - TOTAL, B&H, and EDGE summary rows


LIMITATIONS & CONSIDERATIONS
----------------------------
1. PAST PERFORMANCE: Historical patterns do not guarantee future results.
   Market regimes change, and seasonal patterns can disappear or reverse.

2. SAMPLE SIZE: With 13 years of data (excluding 2020-2021), even a 77%
   trend means only 10 confirming years. Statistical significance is limited.

3. SURVIVORSHIP BIAS: Stocks that exist today may have done so because they
   performed well. Failed companies are not in the analysis.

4. TRANSACTION COSTS: The simulation does not account for commissions,
   slippage, or bid-ask spreads. Frequent trading erodes returns.

5. TAXES: Short-term capital gains are taxed at higher rates. The strategy's
   frequent trading may have tax disadvantages vs B&H.

6. LIQUIDITY: Entry/exit at exact period boundaries assumes perfect liquidity.
   Large positions may move the market.

7. LOOKAHEAD BIAS: The patterns we see today include knowledge of what worked.
   Out-of-sample testing is recommended before live trading.


RECOMMENDED USAGE
-----------------
1. Start with monthly analysis (less noise than weekly)
2. Set threshold to 60-70% to filter weak signals
3. Experiment with offsets to find stronger patterns
4. Compare multiple related symbols to validate patterns
5. Focus on patterns with positive Edge and reasonable Annualized returns
6. Paper trade before committing real capital
7. Re-analyze periodically as new data becomes available
